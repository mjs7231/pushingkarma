# Run Django makemigrations, migrate.
---
- name: Delete Collectstatic
  tags: ['deploy']
  file:
    state: absent
    path: '{{project_dir}}/collectstatic'

- name: Initialize Django
  tags: ['deploy']
  become: yes
  become_user: www-data
  django_manage:
    command={{item}}
    app_path={{project_dir}}
    virtualenv={{virtualenv}}
    settings={{settings}}
  with_items:
    - makemigrations
    - migrate
    - collectstatic --noinput
  notify: Restart Services

- name: Add Update Stocks Cronjob
  cron:
    name: update-stocks
    job: '/usr/bin/python3 /root/pk/manage.py update_stocks'
    hour: 2
