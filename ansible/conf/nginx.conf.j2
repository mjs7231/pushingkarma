# Nginx site configuration
# Jinja2 template file
# server {
#   listen 80;
#   listen [::]:80 ipv6only=on;
#   server_name {{project_name}}.com www.{{project_name}}.com;
#   location '/.well-known/acme-challenge' {
#     default_type "text/plain";
#     root /tmp/letsencrypt-auto;
#   }
#   location / {
#     return 301 https://{{project_name}}.com$request_uri;
#   }
# }

# server {
#   listen 443 ssl;
#   listen [::]:443 ssl ipv6only=on;
#   server_name www.{{project_name}}.com;
#   add_header Strict-Transport-Security "max-age=31536000";
#   ssl on; ssl_prefer_server_ciphers on;
#   ssl_stapling on; ssl_stapling_verify on;
#   ssl_certificate /etc/letsencrypt/live/{{project_name}}.com/fullchain.pem;
#   ssl_certificate_key /etc/letsencrypt/live/{{project_name}}.com/privkey.pem;
#   ssl_trusted_certificate /etc/letsencrypt/live/{{project_name}}.com/fullchain.pem;
#   return 301 https://{{project_name}}.com$request_uri;
# }

server {
  listen 443 ssl;
  listen [::]:443 ssl;
  server_name {{project_name}}.com;
  add_header Strict-Transport-Security "max-age=31536000";
  # ssl on; ssl_prefer_server_ciphers on;
  # ssl_stapling on; ssl_stapling_verify on;
  # ssl_certificate /etc/letsencrypt/live/{{project_name}}.com/fullchain.pem;
  # ssl_certificate_key /etc/letsencrypt/live/{{project_name}}.com/privkey.pem;
  # ssl_trusted_certificate /etc/letsencrypt/live/{{project_name}}.com/fullchain.pem;
  location /static/ {
    alias /var/www/{{project_name}}/collectstatic/;
  }
  location /ws/ {
    proxy_pass http://unix:/var/www/{{project_name}}/web.sock;
    proxy_http_version 1.1;
    proxy_set_header Upgrade $http_upgrade;
    proxy_set_header Connection "upgrade";
    proxy_buffers 8 32k;
    proxy_buffer_size 64k;
  }
  location / {
    include uwsgi_params;
    uwsgi_pass unix:/var/www/{{project_name}}/django.sock;
  }
}
