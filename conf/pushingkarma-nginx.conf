# Nginx site configuration
# Copyright (c) 2015 PushingKarma. All rights reserved.
# location: /etc/nginx/sites-available/pushingkarma.conf
server {
  listen 80;
  listen [::]:80 ipv6only=on;
  server_name pushingkarma.com www.pushingkarma.com;
  location '/.well-known/acme-challenge' {
    default_type "text/plain";
    root /tmp/letsencrypt-auto;
  }
  location / {
    return 301 https://pushingkarma.com$request_uri;
  }
}

server {
  listen 443 ssl;
  listen [::]:443 ssl ipv6only=on;
  server_name www.pushingkarma.com;
  add_header Strict-Transport-Security "max-age=31536000";
  ssl on; ssl_prefer_server_ciphers on;
  ssl_stapling on; ssl_stapling_verify on;
  ssl_certificate /etc/letsencrypt/live/pushingkarma.com/cert.pem;
  ssl_certificate_key /etc/letsencrypt/live/pushingkarma.com/privkey.pem;
  ssl_trusted_certificate /etc/letsencrypt/live/pushingkarma.com/fullchain.pem;
  return 301 https://pushingkarma.com$request_uri;
}

server {
  listen 443 ssl;
  listen [::]:443 ssl;
  server_name pushingkarma.com;
  add_header Strict-Transport-Security "max-age=31536000";
  ssl on; ssl_prefer_server_ciphers on;
  ssl_stapling on; ssl_stapling_verify on;
  ssl_certificate /etc/letsencrypt/live/pushingkarma.com/cert.pem;
  ssl_certificate_key /etc/letsencrypt/live/pushingkarma.com/privkey.pem;
  ssl_trusted_certificate /etc/letsencrypt/live/pushingkarma.com/fullchain.pem;
  location /static/ {
    alias /home/mjs7231/Projects/pushingkarma/pk/collectstatic/;
  }
  location /ws/ {
    proxy_http_version 1.1;
    proxy_set_header Upgrade $http_upgrade;
    proxy_set_header Connection "upgrade";
    proxy_pass http://unix:/home/mjs7231/Projects/pushingkarma/pushingkarmaws.sock;
    proxy_buffers 8 32k;
    proxy_buffer_size 64k;
  }
  location / {
    include uwsgi_params;
    uwsgi_pass unix:/home/mjs7231/Projects/pushingkarma/pushingkarma.sock;
  }
}
