{% comment %}<!--
Budget data attributes:
  data-id: ID of the item being displayed.
  data-name: name of the model field td corresponds to.
  data-default: default value if left blank.
  data-url: API url to use when editing item.
pkrow class attributes:
  pkrow: Group of items relating to a category or transaction (db-row)
  pklight: Highlight this row on hover.
  readonly: Do not allow editing this pkrow.
pkedit class attributes:
  pkedit: Editable category or transaction value (db-value).
  int,float,bool: Display int, float, or bool representaion.
  selectall: Select all content when initializing edit.
  delempty: Delete category or transaction if value empty.
-->{% endcomment %}

{% verbatim %}
  <script id='summary' type='text/x-handlebars-template'>
    <h2>Summary
      <div class='subtext'>
        <span class='numtransactions'>{{addCommas this.summary.transactions}}</span> transactions
        {{yesNo this.summary.uncategorized '|' ''}}
        {{#if this.summary.uncategorized}}
          <a class='error' href='javascript:pk.budget.search("category=none")'>
            <span class='numuncategorized'>{{addCommas this.summary.uncategorized}}</span> uncategorized
          </a>
        {{/if}}
        {{yesNo this.summary.unapproved '|' ''}}
        {{#if this.summary.unapproved}}
          <a class='error' href='javascript:pk.budget.search("approved=false")'>
            <span class='numunapproved'>{{addCommas this.summary.unapproved}} unapproved
          </a>
        {{/if}}
      </div>
    </h2>
    <table cellpadding='0' cellspacing='0' style='clear:both;'>
      <thead><tr>
        {{#each this.summary.totals}}
          <th>{{formatDate this.month '%b'}}</th>
        {{/each}}
        <th class='average'>Average</th>
      </tr></thead>
      <tbody>
        {{#each this.results as |category c|}}
          <tr data-categoryid='{{yesNo this.id this.id 'null'}}' class='pklight'>
            {{#each this.summary.months as |month m|}}
              <td class='{{budgetFlags category month}}' data-details='{{this.details}}' {{#if this.comment}}data-comment='true'{{/if}}><div>
                {{amountInt this.amount}}
              </div></td>
            {{/each}}
            <td class='average'><div>{{amountInt this.summary.average}}</div></td>
          </tr>
        {{/each}}
      </tbody>
      <tfoot><tr>
        {{#each this.summary.totals}}
          <td class='{{yesNo this.amount '' 'zero'}}'><div>
            {{amountInt this.amount}}
          </div></td>
        {{/each}}
        <td class='average'><div>{{amountInt this.summary.average_total}}</div></td>
      </tr></tfoot>
    </table>
  </script>

  <script id='summary_popover' type='text/x-handlebars-template'>
    {{log this}}
    <div class='title'>{{formatDate this.details.month '%B'}} {{this.name}}</div>
    <div class='body' style='min-width:300px;'>
      <div class='math'>
        <div class='number'><span class='subtext'>budget</span>{{amountIntAbs this.budget}}</div>
        <div class='number'><span class='subtext'>&nbsp;</span>-</div>
        <div class='number'><span class='subtext'>spent</span>{{amountIntAbs this.details.total}}</div>
        <div class='number'><span class='subtext'>&nbsp;</span>=</div>
        <div class='number'><span class='subtext'>remaining</span>{{budgetMath this.budget this.details.total}}</div>
      </div>
      <div class='pkrow' data-id='{{this.id}}' data-url='{{this.details.details}}'>
        <div data-name='comment' class='pkedit'>
          <textarea spellcheck='false' placeholder='Notes'>{{this.details.comment}}</textarea>
        </div>
      </div>
      <table cellpadding='0' cellspacing='0' style='clear:both;'>
        <tbody>
         {{#each this.details.recent}}
           <tr class='pkrow' data-id='{{this.id}}' data-type='transaction' data-url='{{this.url}}'>
             <td data-name='date' class='pkedit'><div>{{this.date}}</div></td>
             <td data-name='payee' class='pkedit selectall'><div>{{this.payee}}</div></td>
             <td data-name='amount' class='float'><div>{{amountFloat this.amount}}</div></td>
           </tr>
         {{/each}}
        </tbody>
      </table>
      <a class='error' href="javascript:pk.budget.search('date={{formatDate this.details.month '%b'}} category=\'{{this.name}}\'')">view transactions</a>
    </div>
  </script>

  <script id='accounts_list' type='text/x-handlebars-template'>
    <table cellpadding='0' cellspacing='0'>
      <thead><tr>
        <th data-name='account'>Account</th>
        <th data-name='account'>Date</th>
        <th data-name='balance' class='int'>Balance</th>
      </tr></thead>
      <tbody>
        {{#each this.results}}
          <tr data-id='{{this.id}}'>
            <td data-name='account'><div>{{this.name}}</div></td>
            <td data-name='date'><div>{{formatDate this.balancedt '%b %e'}}</div></td>
            <td data-name='balance' class='int'><div>{{amountInt this.balance}}</div></td>
          </tr>
        {{/each}}
      </tbody>
      <tfoot><tr>
        <td data-name='account'><div>Total</div></td>
        <td data-name='date'>&nbsp;</td>
        <td data-name='balance' class='int'><div>{{amountInt this.total}}</div></td>
      </tr></tfoot>
    </table>
  </script>

  <script id='category_list' type='text/x-handlebars-template'>
    <table cellpadding='0' cellspacing='0'>
      <thead><tr>
        <th data-name='name'>Category</th>
        <th data-name='trend'>Trend</th>
        <th data-name='budget'>Budget</th>
      </tr></thead>
      <tbody>
        {{#each this.results}}
          <tr class='pkrow pklight' data-id='{{this.id}}' data-type='category' data-url='{{this.url}}' data-details='{{this.details}}'>
            <td data-name='name' class='{{yesNo this.url 'pkedit' ''}} delempty'><div>{{this.name}}</div></td>
            <td data-name='trend' class='drag'></td>
            <td data-name='budget' class='{{yesNo this.url 'pkedit' ''}} int selectall' {{#if this.comment}}data-comment='true'{{/if}}><div>{{amountInt this.budget}}</div></td>
          </tr>
        {{/each}}
      </tbody>
      <tfoot> 
        <tr id='category-total'>
          <td data-name='name'><div>Total</div></td>
          <td data-name='trend'><div>&nbsp;</div></td>
          <td data-name='budget'><div>{{amountInt this.total}}</div></td>
        </tr>
        <tr id='category-add' class='pkrow' data-type='category' data-url='/api/categories'>
          <td data-name='name'><input name='name' type='text' placeholder='New Category' autocomplete='off'></td>
          <td data-name='trend'>&nbsp;</td>
          <td data-name='budget' data-default='0'><input name='budget' type='integer' placeholder='$0' autocomplete='off'></td>
        </tr>
      </tfoot>
    </table>
  </script>

  <script id='category_popover' type='text/x-handlebars-template'>
    <div class='title'>{{this.name}}</div>
    <div class='body' style='min-width:200px;'>
      <dl>
        <dt>Transactions:</dt><dd>{{addCommas this.details.transactions}}</dd>
        <dt>Spent:</dt><dd>{{amountInt this.details.total}}<div class='subtext'>({{this.details.num_months}} months)</div></dd>
        <dt>Average:</dt><dd>{{amountInt this.details.average}}<div class='subtext'>({{this.details.average_months}} months)</div></dd>
      </dl>
      <div class='pkrow' data-id='{{this.id}}' data-url='{{this.url}}'>
        <div data-name='comment' class='pkedit'>
          <textarea spellcheck='false' placeholder='Notes'>{{this.comment}}</textarea>
        </div>
      </div>
      <a class='error' href="javascript:pk.budget.search('category=\'{{this.name}}\'', false)">view transactions</a>
    </div>
  </script>

  <script id='transaction_list' type='text/x-handlebars-template'>
    <h2>Transactions
      <div class='subtext'>
        <span class='numtransactions'>{{addCommas this.count}}</span> transactions
        {{yesNo this.uncategorized '|' ''}}
        {{#if this.uncategorized}}
          <a class='error' href='javascript:pk.budget.search("category=none", true)'>
            <span class='numuncategorized'>{{addCommas this.uncategorized}}</span> uncategorized
          </a>
        {{/if}}
        {{yesNo this.unapproved '|' ''}}
        {{#if this.unapproved}}
          <a class='error' href='javascript:pk.budget.search("approved=false", true)'>
            <span class='numunapproved'>{{addCommas this.unapproved}}</span> unapproved
          </a>
        {{/if}}
      </div>
    </h2>
    <table cellpadding='0' cellspacing='0' style='clear:both;'>
      <thead><tr>
        <th data-name='account'>Bank</th>
        <th data-name='date'>Date</th>
        <th data-name='payee'>Payee</th>
        <th data-name='category'>Category</th>
        <th data-name='amount'>Amount</th>
        <th data-name='approved'>X</th>
        <th data-name='comment'>Comment</th>
      </tr></thead>
      <tbody>
       {{#each this.results}}
         <tr class='pkrow' data-id='{{this.id}}' data-type='transaction' data-url='{{this.url}}'>
           <td data-name='account'><div>{{this.account.name}}</div></td>
           <td data-name='date' class='pkedit'><div>{{this.date}}</div></td>
           <td data-name='payee' class='pkedit selectall'><div>{{this.payee}}</div></td>
           <td data-name='category' class='pkedit selectall'><div>{{this.category.name}}</div></td>
           <td data-name='amount' class='float'><div>{{amountFloat this.amount}}</div></td>
           <td data-name='approved' class='pkedit bool selectall'><div>{{yesNo this.approved 'x' ''}}</div></td>
           <td data-name='comment' class='pkedit'><div>{{this.comment}}</div></td>
         </tr>
       {{/each}}
       {{#if this.next}}
         <tr id='loadmore' data-next='{{this.next}}'>
           <td colspan='100%'>Loading more transactions..</td>
         </tr>
       {{/if}}
      </tbody>
    </table>
  </script>
{% endverbatim %}
